# OS_Design_Simdisk_VFS

# 模拟Linux文件系统与操作管理设计

## 设计一：模拟Linux文件系统

### 概述
在任一系统中，通过创建一个100MB的大文件模拟物理磁盘，实现一个简化版的Linux文件系统。管理程序`simdisk`提供文件/目录操作、权限管理及系统维护功能。

---

### 核心结构
1. **磁盘布局**
   - 总容量：100MB
   - 盘块大小：1KB（共102,400个盘块）
   - 空闲空间管理：Linux位图法（bitmap）
   - 分区结构：
     - **超级块**：存储文件系统元数据（总块数、空闲块数、i节点数等）
     - **i节点区**：存储文件/目录的元数据（权限、大小、数据块指针等）
     - **根目录区**：初始目录结构（`/`）

---

### 功能命令

#### 1. 系统管理
- **`info`**  
  显示系统信息（总空间、可用空间、i节点使用情况），支持文件读写保护（权限码格式：`rwx`）。

- **`check`**  
  检测文件系统一致性，自动修复数据错误（如位图与i节点状态不一致）。

---

#### 2. 目录操作
- **`cd <路径>`**  
  切换当前目录，支持绝对路径（如`/home/user`）和相对路径（如`../docs`）。

- **`dir [/s] <路径>`**  
  显示目录内容，包含文件名、物理地址、权限、大小及子目录。  
  参数`/s`递归显示所有子目录。

- **`md <目录名>`**  
  创建新目录，重名时返回错误。

- **`rd <目录名>`**  
  删除目录及其内容，非空时提示确认。

---

#### 3. 文件操作
- **`newfile <文件名>`**  
  创建空文件，权限默认为`rw-`（用户可读写）。

- **`cat <文件名>`**  
  显示文件内容（等效于`type`命令）。

- **`copy <源文件> <目标路径>`**  
  支持跨系统拷贝：
  - 从Host系统拷贝：`<host>D:\data\file.txt /simdisk/path`
  - 内部拷贝：`/source/file.txt /target/dir`

- **`del <文件名>`**  
  删除文件，自动回收i节点和数据块。

---

### 程序流程
1. 初始化文件系统（若首次运行则格式化磁盘文件）。
2. 循环等待用户输入，解析命令并执行。
3. 输入`exit`退出程序。

---

## 设计二：前端操作Shell

### 目标
实现与`simdisk`后台进程通信的简易Shell，通过**共享内存**完成进程间通信（IPC）。

### 功能
- 命令行参数传递（如`simdisk copy <host>file.txt /target`）。
- 前后端分离架构：Shell作为前端解析命令，`simdisk`作为后台处理请求。

---

## 设计三：多进程操作管理

### 核心需求
1. **并发控制**  
   - **共享读**：允许多进程同时读取同一文件。
   - **互斥写**：写操作需独占访问，防止数据竞争。

2. **权限管理**  
   - 每个进程关联用户身份，权限存储于i节点（`rwx`三位）。
   - 操作前验证用户权限（如写操作需`w`权限）。

---

### 实现要点
- **同步机制**：使用信号量或互斥锁保护临界区（如位图修改、i节点更新）。
- **用户隔离**：通过进程的用户ID（UID）控制资源访问。

---

## 运行示例
```bash
# 启动simdisk后台进程
simdisk start

# 通过Shell执行命令
simdisk shell
> md /test
> copy <host>C:\data\file.txt /test
> dir /s /
